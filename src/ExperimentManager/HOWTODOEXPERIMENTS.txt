0) Make sure you have followed "README.txt" in the same folder as this file to set-up the Experiment
1) Start the ExperimentManager GUI
2) Start the ExperimentClient on each of the smartphones, and press "Connect" to make a connection with the ExperimentManager.
When a phone is connected, one of the tiles in the GUI should switch to green.
Make sure that the phone with the Monsoon attached is connected first. Normally, the code should be robust to handle the case
if you do not do this, but it is untested...

3) First choose the type of experiment you want to do. In the paper, we only reported the following:
- random all but one 480p
- random all but one 1080p
- slotted all but one 480p
- slotted all but one 1080p

The "all but one" means that the Reference Device always uploads the same video, and that the other nodes are
uploading different videos. The Reference Device should be the one attached to the Monsoon Power Monitor, and 
you should have its IP configured in ExperimentConfiguration.java

4) Then, you have to choose one video
For "480p" experiments, you should choose: "480p_3_Pittsburgh"
for "1080p" experiments, you should choose: "1080p_2_Pittsburgh"

The GUI would have been better designed if it picks this video automatically when you choose an experimenttype in the first
dropdown menu, but it has been gradually extended and the scope of experiments changed over the weeks.

5) Then, choose the length of the video segments to be used, configure the min/max number of nodes in the experiment, and the duration.
For the paper, I used a duration of 600s for 5s/30s experiments, and 1200s for 300s experiments. 

6) Check "Upload files during initialization" if the video files are not yet on the phones because of a previous experiment. Everytime
you upload new video files, the previous ones are deleted.

7) The checkbox "loop over files" should be left unchecked and is of no use

8) Press 'Init' --> the videos for the experiment will start to upload (if you have checked that checkbox).
!!Even if you do not upload new videos, you should still press init

9) Press Start. The experiment will start. It will do a number of iterations for a number of nodes. It starts with
the max number of nodes configured, and then removes one node at a time. If you configured the minimum number of
nodes to "1", then the only device that is left 

10) There is no real message saying that the complete experiment has finished. Probably the last message you will see is
"Waiting one more chunk sec to stop experiment". 

NOTES:
- do not mind that you see "null_chopxxx.mp4" in the log of the GUI, it is not an error!

************************* How to parse the results??? ******************************
You find the scripts needed in the "tool" directory on GIT.
Although you will only explicitly call a few of them, you need to import them all, because some
scripts call other scripts while running.

There are three things that must be parsed:
1) The individual throughput of a device
2) The total throughput to the cloudlet
3) The number of bytes received by the cloudlet (needed for the energy measurements)


We will discuss them now:
1) Individual throughput
* Run the script "bash parseAllIndividualThroughput.sh" DIR/480p_3_Pittsburgh_5

--> DIR is the directory where the results of the experiments can be found. These results are the ".log" files generated by the Python server, so
initially you find them in the /tmp directory
--> The first part of the argument refers to the video used. This should be DIR/480p_3_Pittsburgh or DIR/1080p_2_Pittsburhg
--> 480p_3_Pittsburgh_5; 480p_3_Pittsburgh_30; 480p_3_Pittsburgh_300 are the only valid arguments for 480p (5/30/300 refers to the chunks used)
--> 1080p_2_Pittsburgh_5; 1080p_2_Pittsburgh_30; 1080p_2_Pittsburgh_300 are the only valid arguments for 1080p (5/30/300 refers to the chunks used)

* Now you have to combine the individual iterations to one larger file. This larger file can be imported in Excel. There is one file
per number of nodes.
* Run the script "bash pasteAllIndividualThroughput.sh" DIR/480p_3_Pittsburgh_5_1 for 5 seconds, and 1 node. Change the last figure for a different
number of nodes (1,2,..8) and the last but one figure for a different segment size.

This will generate .txt files in the same directory as the original log files. "individualthroughputjoined.txt". These are the files you can 
import in Excel to generate graphs.


2) Cumulative throughput
Completely similar to the previous step, but now you should use the following scripts:
bash parseAllThroughput.sh DIR/480p_3_Pittsburgh_5 (etc.)
bash pasteAllThroughput.sh DIR/480p_3_Pittsburhg_5_1 (etc.)

You can have a look at the Excel files on the data storage to see how you can process these files.

3) The number of bytes received by the cloudlet from a specific node
This is needed for the energy measurements. It shows how many
bytes are transmitted in the first 585 seconds of the experiment.  (or 1185 for the 300s experiments were we used 1200 s duration)
We divide the average power consumed (as measured by the Monsoon) by this number. This was
the number reported in the submission.

You will use the script "calculateBytesTransmitted" for this.
First, change the "filepath" in the script to the path where
the log files of TSHARK are stored.
Second, change 192.168.2.7 to the IP of the phone attached to the Monsoon Power Monitor.

Call the script as follows:
bash calculateBytesTransmitted.sh 480p_3_Pittsburgh_5   (so no DIR, no specification of the number of nodes)
It will generate a file "480p_3_Pittsburgh_5_bytes.txt".
It assumes that you have results for 1..8 nodes, and 10 iterations each. You might change this in the script
if you have a different number of results. 

The results can be imported in Excel. Have a look at the Excel files to see how this should be done.
